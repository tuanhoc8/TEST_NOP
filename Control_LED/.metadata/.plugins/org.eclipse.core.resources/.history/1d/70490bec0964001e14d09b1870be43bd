#include "init.h"

static volatile uint16_t DELAY = 1000;

void blinkLed(void)__attribute__((section(".flash_blinkled")));
void blinkLed(void)
{
	for(;;)
	{
		GPIOD->PDOR = (1 << 0) | (1 << 16);
		delay_ms(DELAY);
		GPIOD->PDOR = (1 << 0) | (1 << 15);
		delay_ms(DELAY);
		GPIOD->PDOR = (1 << 15) | (1 << 16);
		delay_ms(DELAY);
	}
}

int main(void)
{
	init_clock();
	init_gpio();
	init_lpit();
	init_lpuart1();

	blinkLed();
}

void PORTC_IRQHandler(void)
{
	if((PORT_C->PCR[12] & (1 << 24)) != 0)
	{
		PORT_C->PCR[12] |= (1u << 24);
		DELAY += 100;
		counter++;
		if(DELAY > 1500)
		{
			DELAY = 1500;
		}
		if(counter > 20)
		{
			counter = 20;
		}
	}

	else if((PORT_C->PCR[13] & (1 << 24)) != 0)
	{
		PORT_C->PCR[13] |= (1u << 24);
		button2_is_pressed ^= 1;
		if(button2_is_pressed == 0)
		{
			DELAY -= 100;
			counter--;
			if(DELAY < 500)
			{
				DELAY = 500;
			}
			if(counter <= 0)
			{
				counter = 0;
			}
		}
	}
}
